//
//  SearchResourceTest.swift
//  UnsplashSearchTests
//
//  Created by Marcel Hasselaar on 2018-03-19.
//  Copyright Â© 2018 Unbad Apps Stockholm HB. All rights reserved.
//

import XCTest
@testable import UnsplashSearch

class SearchResourceTest: XCTestCase {

    override func setUp() {
        super.setUp()
        // Put setup code here. This method is called before the invocation of each test method in the class.
    }
    
    override func tearDown() {
        // Put teardown code here. This method is called after the invocation of each test method in the class.
        super.tearDown()
    }
    
    func testParsingValidSearchResult() {
        let searchResource = SearchResources.createSearchResource(for: "whatever")
        let headerFields = [
            "Link": testLinkHeader
        ]
        let mockHttpResponse = HTTPURLResponse(url: URL(string: "whatever")!, statusCode: 200, httpVersion: "1.1", headerFields: headerFields)!
        let jsonData = testJson.data(using: .utf8)!
        guard let searchResult = searchResource?.parse(jsonData, mockHttpResponse) else {
            XCTFail("Parsing failed")
            return
        }
        XCTAssertTrue(searchResult.images?.count ?? 0 == 4)
        XCTAssertTrue(searchResult.firstResult == nil)
        XCTAssertTrue(searchResult.nextResult?.absoluteString == "https://api.unsplash.com/search/photos?page=2&per_page=4&query=beaches")
        XCTAssertTrue(searchResult.total == 5503)
        XCTAssertTrue(searchResult.totalPages == 1376)
        let firstImage = searchResult.images![0]
        XCTAssertTrue(firstImage.id == "74iztAgoTK0")
        XCTAssertTrue(firstImage.thumbnailUrl.absoluteString == "https://images.unsplash.com/photo-1506285505203-8b98518c0148?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=200&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=d3a968f7f1f3e9862a2664fc967dff46")
        XCTAssertTrue(firstImage.imageUrl.absoluteString == "https://images.unsplash.com/photo-1506285505203-8b98518c0148?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=e2e5dc69a8ab466a0b91607c1fa396a2")
    }

    private var testLinkHeader = """
         <https://api.unsplash.com/search/photos?page=1375&per_page=4&query=beaches>; rel="last", <https://api.unsplash.com/search/photos?page=2&per_page=4&query=beaches>; rel="next"
    """

    private var testJson: String = """
        {"total":5503,"total_pages":1376,"results":[{"id":"74iztAgoTK0","created_at":"2017-09-24T16:40:27-04:00","updated_at":"2017-10-30T15:55:35-04:00","width":5472,"height":3648,"color":"#FDFDFC","description":null,"categories":[],"urls":{"raw":"https://images.unsplash.com/photo-1506285505203-8b98518c0148?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=ca29729eeb1a2ec3bd92c2a72208ada3","full":"https://images.unsplash.com/photo-1506285505203-8b98518c0148?ixlib=rb-0.3.5&q=85&fm=jpg&crop=entropy&cs=srgb&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=6e81089af1f0831f6619f9513267c21a","regular":"https://images.unsplash.com/photo-1506285505203-8b98518c0148?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=e2e5dc69a8ab466a0b91607c1fa396a2","small":"https://images.unsplash.com/photo-1506285505203-8b98518c0148?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=400&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=b56bebfdad7019162be24602a20a8b87","thumb":"https://images.unsplash.com/photo-1506285505203-8b98518c0148?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=200&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=d3a968f7f1f3e9862a2664fc967dff46"},"links":{"self":"https://api.unsplash.com/photos/74iztAgoTK0","html":"https://unsplash.com/photos/74iztAgoTK0","download":"https://unsplash.com/photos/74iztAgoTK0/download","download_location":"https://api.unsplash.com/photos/74iztAgoTK0/download"},"liked_by_user":false,"sponsored":false,"likes":21,"user":{"id":"fbPZwdKgWWs","updated_at":"2018-03-18T11:39:34-04:00","username":"tentides","name":"Jeremy Bishop","first_name":"Jeremy","last_name":"Bishop","twitter_username":null,"portfolio_url":"http://jeremybishopphotography.com","bio":"@tentidesGlobal Expeditions |Surf |Adventure  ","location":"California","links":{"self":"https://api.unsplash.com/users/tentides","html":"https://unsplash.com/@tentides","photos":"https://api.unsplash.com/users/tentides/photos","likes":"https://api.unsplash.com/users/tentides/likes","portfolio":"https://api.unsplash.com/users/tentides/portfolio","following":"https://api.unsplash.com/users/tentides/following","followers":"https://api.unsplash.com/users/tentides/followers"},"profile_image":{"small":"https://images.unsplash.com/profile-1475405901109-04b2f633a548?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=32&w=32&s=8bb5a4dcbbe82648e3c78eb143435886","medium":"https://images.unsplash.com/profile-1475405901109-04b2f633a548?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=64&w=64&s=164eaa85bd58a3e71871d0387246310c","large":"https://images.unsplash.com/profile-1475405901109-04b2f633a548?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=128&w=128&s=07596ffc8a1763674708a2d8500f2427"},"total_collections":15,"instagram_username":"tentides","total_likes":3636,"total_photos":699},"current_user_collections":[],"photo_tags":[{"title":"beach"},{"title":"ocean"},{"title":"sea"},{"title":"coastline"},{"title":"cliff"}]},{"id":"iqLK5HdtRuM","created_at":"2016-05-18T09:48:41-04:00","updated_at":"2017-12-12T12:40:31-05:00","width":5616,"height":3744,"color":"#171E0B","description":"Tall cliffs on the sandy beach coastline at West Bexington Pond","categories":[],"urls":{"raw":"https://images.unsplash.com/photo-1463579239518-ecbd30853614?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=ef092e19eb0f9805d2a5839155573aad","full":"https://images.unsplash.com/photo-1463579239518-ecbd30853614?ixlib=rb-0.3.5&q=85&fm=jpg&crop=entropy&cs=srgb&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=3e1d6880c31f0ed61c310bec4249ea4e","regular":"https://images.unsplash.com/photo-1463579239518-ecbd30853614?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=cd176668676563ce24ed35cf6b175ad5","small":"https://images.unsplash.com/photo-1463579239518-ecbd30853614?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=400&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=6fc40399ed9b7c432fd999d3b07dcd34","thumb":"https://images.unsplash.com/photo-1463579239518-ecbd30853614?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=200&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=b6d286c4f4b6ef3ab4dae43d9a3b5a4f"},"links":{"self":"https://api.unsplash.com/photos/iqLK5HdtRuM","html":"https://unsplash.com/photos/iqLK5HdtRuM","download":"https://unsplash.com/photos/iqLK5HdtRuM/download","download_location":"https://api.unsplash.com/photos/iqLK5HdtRuM/download"},"liked_by_user":false,"sponsored":false,"likes":36,"user":{"id":"Gw_8Guqk45s","updated_at":"2018-03-17T04:49:09-04:00","username":"daanhuttinga","name":"Daan Huttinga","first_name":"Daan","last_name":"Huttinga","twitter_username":null,"portfolio_url":"http://daanhuttinga.nl","bio":"Moviemaker and photographer from the Netherlands. instagram.com/daanhuttinga ","location":"Utrecht","links":{"self":"https://api.unsplash.com/users/daanhuttinga","html":"https://unsplash.com/@daanhuttinga","photos":"https://api.unsplash.com/users/daanhuttinga/photos","likes":"https://api.unsplash.com/users/daanhuttinga/likes","portfolio":"https://api.unsplash.com/users/daanhuttinga/portfolio","following":"https://api.unsplash.com/users/daanhuttinga/following","followers":"https://api.unsplash.com/users/daanhuttinga/followers"},"profile_image":{"small":"https://images.unsplash.com/profile-1502306611112-cbc4488dc7c7?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=32&w=32&s=ba23ee11d7f48bce9c3fdff2a6350846","medium":"https://images.unsplash.com/profile-1502306611112-cbc4488dc7c7?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=64&w=64&s=7447b238ddf4f9aa255917f4342f5e8c","large":"https://images.unsplash.com/profile-1502306611112-cbc4488dc7c7?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=128&w=128&s=b6b1c79e2b8568c7084897b7a062fda5"},"total_collections":0,"instagram_username":"daanhuttinga","total_likes":0,"total_photos":26},"current_user_collections":[],"photo_tags":[{"title":"cliff"},{"title":"beach"},{"title":"cloud"},{"title":"sky"},{"title":"ocean"}]},{"id":"pV8fZ0qUe84","created_at":"2017-08-07T13:24:08-04:00","updated_at":"2017-10-31T08:28:30-04:00","width":6016,"height":4000,"color":"#00483F","description":null,"categories":[],"urls":{"raw":"https://images.unsplash.com/photo-1502126524499-4cd4567f046c?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=5731a8aa9dd38534dfc4db105df99861","full":"https://images.unsplash.com/photo-1502126524499-4cd4567f046c?ixlib=rb-0.3.5&q=85&fm=jpg&crop=entropy&cs=srgb&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=c408f3c58ed79fef2bac671f961af39e","regular":"https://images.unsplash.com/photo-1502126524499-4cd4567f046c?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=ccef83a8957552975f784dc4259f62a3","small":"https://images.unsplash.com/photo-1502126524499-4cd4567f046c?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=400&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=06b7247a90efb7311ed53137ca46fc0c","thumb":"https://images.unsplash.com/photo-1502126524499-4cd4567f046c?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=200&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=878a318c51054ae9e0f07a6d9ce82169"},"links":{"self":"https://api.unsplash.com/photos/pV8fZ0qUe84","html":"https://unsplash.com/photos/pV8fZ0qUe84","download":"https://unsplash.com/photos/pV8fZ0qUe84/download","download_location":"https://api.unsplash.com/photos/pV8fZ0qUe84/download"},"liked_by_user":false,"sponsored":false,"likes":85,"user":{"id":"E7TZ0pq31zg","updated_at":"2017-10-31T08:28:30-04:00","username":"marianneaheino","name":"Marianne Heino","first_name":"Marianne","last_name":"Heino","twitter_username":null,"portfolio_url":null,"bio":null,"location":null,"links":{"self":"https://api.unsplash.com/users/marianneaheino","html":"https://unsplash.com/@marianneaheino","photos":"https://api.unsplash.com/users/marianneaheino/photos","likes":"https://api.unsplash.com/users/marianneaheino/likes","portfolio":"https://api.unsplash.com/users/marianneaheino/portfolio","following":"https://api.unsplash.com/users/marianneaheino/following","followers":"https://api.unsplash.com/users/marianneaheino/followers"},"profile_image":{"small":"https://images.unsplash.com/placeholder-avatars/extra-large.jpg?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=32&w=32&s=0ad68f44c4725d5a3fda019bab9d3edc","medium":"https://images.unsplash.com/placeholder-avatars/extra-large.jpg?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=64&w=64&s=356bd4b76a3d4eb97d63f45b818dd358","large":"https://images.unsplash.com/placeholder-avatars/extra-large.jpg?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=128&w=128&s=ee8bbf5fb8d6e43aaaa238feae2fe90d"},"total_collections":1,"instagram_username":"marianneaheino","total_likes":0,"total_photos":1},"current_user_collections":[],"photo_tags":[{"title":"ocean"},{"title":"sea"},{"title":"wave"},{"title":"water"},{"title":"beach"}]},{"id":"IMuSjroToC8","created_at":"2017-10-11T12:18:21-04:00","updated_at":"2017-10-26T01:22:52-04:00","width":6000,"height":4000,"color":"#070B0D","description":null,"categories":[],"urls":{"raw":"https://images.unsplash.com/photo-1507738471757-ab1675ad2a89?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=daa158813c36f9c949a8da836b9cb94b","full":"https://images.unsplash.com/photo-1507738471757-ab1675ad2a89?ixlib=rb-0.3.5&q=85&fm=jpg&crop=entropy&cs=srgb&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=25fc8b1a8069108c2684ee63ed8ea16a","regular":"https://images.unsplash.com/photo-1507738471757-ab1675ad2a89?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=6c9a05adbce73ac53979307795a60064","small":"https://images.unsplash.com/photo-1507738471757-ab1675ad2a89?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=400&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=6103ec619e60815690510872c32cdef0","thumb":"https://images.unsplash.com/photo-1507738471757-ab1675ad2a89?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=200&fit=max&ixid=eyJhcHBfaWQiOjIyOTE3fQ&s=912d950e337c045d3323b4307ad54575"},"links":{"self":"https://api.unsplash.com/photos/IMuSjroToC8","html":"https://unsplash.com/photos/IMuSjroToC8","download":"https://unsplash.com/photos/IMuSjroToC8/download","download_location":"https://api.unsplash.com/photos/IMuSjroToC8/download"},"liked_by_user":false,"sponsored":false,"likes":49,"user":{"id":"rj1BVW6fEhQ","updated_at":"2018-02-23T04:15:57-05:00","username":"collectivecreatorsco","name":"Ruben Gutierrez","first_name":"Ruben","last_name":"Gutierrez","twitter_username":null,"portfolio_url":"http://www.rubenagutierrez.com","bio":"Filmmaker, photographer, and content creatorFollow me on Instagram for more @rubengutierrez_","location":null,"links":{"self":"https://api.unsplash.com/users/collectivecreatorsco","html":"https://unsplash.com/@collectivecreatorsco","photos":"https://api.unsplash.com/users/collectivecreatorsco/photos","likes":"https://api.unsplash.com/users/collectivecreatorsco/likes","portfolio":"https://api.unsplash.com/users/collectivecreatorsco/portfolio","following":"https://api.unsplash.com/users/collectivecreatorsco/following","followers":"https://api.unsplash.com/users/collectivecreatorsco/followers"},"profile_image":{"small":"https://images.unsplash.com/profile-1504714311187-eabf8a9a3e04?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=32&w=32&s=75f7fd10e15f44236b504fce8ea4124c","medium":"https://images.unsplash.com/profile-1504714311187-eabf8a9a3e04?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=64&w=64&s=cb231004b20cfa22e1ac947c482604ba","large":"https://images.unsplash.com/profile-1504714311187-eabf8a9a3e04?ixlib=rb-0.3.5&q=80&fm=jpg&crop=faces&cs=tinysrgb&fit=crop&h=128&w=128&s=362118fe8a6a6d422b663d2e77e29d9b"},"total_collections":0,"instagram_username":"Rubengutierrez_","total_likes":0,"total_photos":23},"current_user_collections":[],"photo_tags":[{"title":"skateboard"},{"title":"sport"},{"title":"skating"},{"title":"skateboarding"},{"title":"skater"}]}]}
        """
}
